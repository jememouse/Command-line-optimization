# ============================================================================
# å¢å¼ºç‰ˆ Zsh é…ç½®æ–‡ä»¶
# å®ç°å®æ—¶å‘½ä»¤å»ºè®®ã€æ™ºèƒ½è¡¥å…¨ã€ä¸Šä¸‹æ–‡æ„ŸçŸ¥ç­‰åŠŸèƒ½
# ============================================================================

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# ============================================================================
# Oh My Zsh é…ç½®
# ============================================================================
export ZSH="$HOME/.oh-my-zsh"

# è®¾ç½®ä¸»é¢˜
ZSH_THEME="powerlevel10k/powerlevel10k"

# æ’ä»¶é…ç½®
plugins=(
    git                           # Git é›†æˆ
    brew                         # Homebrew è¡¥å…¨
    macos                        # macOS ç‰¹å®šåŠŸèƒ½
    zsh-autosuggestions          # å®æ—¶å‘½ä»¤å»ºè®®
    zsh-syntax-highlighting      # è¯­æ³•é«˜äº®
    zsh-completions              # å¢å¼ºè¡¥å…¨
    zsh-history-substring-search # å†å²æœç´¢
    you-should-use              # åˆ«åæé†’
    colored-man-pages           # å½©è‰² man é¡µé¢
    command-not-found           # å‘½ä»¤æœªæ‰¾åˆ°å»ºè®®
    copypath                    # å¤åˆ¶è·¯å¾„
    copyfile                    # å¤åˆ¶æ–‡ä»¶å†…å®¹
    dirhistory                  # ç›®å½•å†å²
    jsontools                   # JSON å·¥å…·
    web-search                  # ç½‘ç»œæœç´¢
    extract                     # æ™ºèƒ½è§£å‹
)

# åŠ è½½ Oh My Zsh
source $ZSH/oh-my-zsh.sh

# ============================================================================
# å†å²é…ç½® - æ™ºèƒ½å†å²è®°å½•
# ============================================================================
HISTFILE=~/.zsh_history
HISTSIZE=50000                   # å†…å­˜ä¸­çš„å†å²è®°å½•æ•°
SAVEHIST=50000                   # æ–‡ä»¶ä¸­çš„å†å²è®°å½•æ•°

# å†å²é€‰é¡¹
setopt EXTENDED_HISTORY          # è®°å½•æ—¶é—´æˆ³
setopt HIST_EXPIRE_DUPS_FIRST    # åˆ é™¤é‡å¤çš„æ—§è®°å½•
setopt HIST_IGNORE_DUPS          # ä¸è®°å½•é‡å¤çš„å‘½ä»¤
setopt HIST_IGNORE_ALL_DUPS      # åˆ é™¤æ‰€æœ‰é‡å¤
setopt HIST_FIND_NO_DUPS         # æœç´¢æ—¶ä¸æ˜¾ç¤ºé‡å¤
setopt HIST_IGNORE_SPACE         # å¿½ç•¥ä»¥ç©ºæ ¼å¼€å¤´çš„å‘½ä»¤
setopt HIST_SAVE_NO_DUPS         # ä¿å­˜æ—¶ä¸è®°å½•é‡å¤
setopt HIST_REDUCE_BLANKS        # åˆ é™¤å¤šä½™ç©ºæ ¼
setopt HIST_VERIFY               # å†å²æ‰©å±•æ—¶ç¡®è®¤
setopt INC_APPEND_HISTORY        # å®æ—¶è¿½åŠ å†å²
setopt SHARE_HISTORY             # å…±äº«å†å²è®°å½•

# ============================================================================
# è¡¥å…¨ç³»ç»Ÿé…ç½® - æ™ºèƒ½å‚æ•°è¡¥å…¨
# ============================================================================
autoload -U compinit && compinit

# è¡¥å…¨é€‰é¡¹
setopt COMPLETE_IN_WORD          # åœ¨å•è¯ä¸­é—´ä¹Ÿèƒ½è¡¥å…¨
setopt ALWAYS_TO_END             # è¡¥å…¨åå…‰æ ‡ç§»åˆ°æœ«å°¾
setopt PATH_DIRS                 # åœ¨è·¯å¾„ä¸­æœç´¢è¡¥å…¨
setopt AUTO_MENU                 # è‡ªåŠ¨èœå•
setopt AUTO_LIST                 # è‡ªåŠ¨åˆ—å‡ºé€‰æ‹©
setopt AUTO_PARAM_SLASH          # ç›®å½•åè‡ªåŠ¨æ·»åŠ æ–œæ 
setopt FLOW_CONTROL              # å¯ç”¨æµæ§åˆ¶

# è¡¥å…¨æ ·å¼
zstyle ':completion:*' menu select
zstyle ':completion:*' group-name ''
zstyle ':completion:*' verbose yes
zstyle ':completion:*:descriptions' format '%B%d%b'
zstyle ':completion:*:messages' format '%d'
zstyle ':completion:*:warnings' format 'No matches for: %d'
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}

# æ™ºèƒ½å¤§å°å†™åŒ¹é…
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'

# è¿›ç¨‹è¡¥å…¨
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#) ([0-9a-z-]#)*=01;34=0=01'
zstyle ':completion:*:*:*:*:processes' command "ps -u $USER -o pid,user,comm -w -w"

# ============================================================================
# ç¯å¢ƒå˜é‡å’Œè·¯å¾„
# ============================================================================
# ç¼–è¾‘å™¨
export EDITOR='code'
export VISUAL='code'

# è¯­è¨€ç¯å¢ƒ
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# è·¯å¾„é…ç½®
export PATH="/opt/homebrew/bin:$PATH"
export PATH="/usr/local/bin:$PATH"
export PATH="$HOME/.local/bin:$PATH"

# FZF é…ç½®
export FZF_DEFAULT_OPTS="--height 40% --layout=reverse --border --inline-info"
export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"

# ============================================================================
# å·¥å…·é›†æˆ
# ============================================================================
# Zoxide (æ™ºèƒ½ cd)
if command -v zoxide &> /dev/null; then
    eval "$(zoxide init zsh)"
fi

# FZF é›†æˆ
if command -v fzf &> /dev/null; then
    source <(fzf --zsh)
fi

# TheFuck é›†æˆ
if command -v thefuck &> /dev/null; then
    eval $(thefuck --alias)
fi

# ============================================================================
# æ’ä»¶ç‰¹å®šé…ç½®
# ============================================================================
# zsh-autosuggestions é…ç½®
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=#666666,underline"
ZSH_AUTOSUGGEST_STRATEGY=(history completion)
ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE=20

# zsh-history-substring-search é…ç½®
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down
bindkey '^P' history-substring-search-up
bindkey '^N' history-substring-search-down

# you-should-use é…ç½®
export YSU_MESSAGE_POSITION="after"
export YSU_HARDCORE=1

# ============================================================================
# æ™ºèƒ½åˆ«åç³»ç»Ÿ - ä¸Šä¸‹æ–‡æ„ŸçŸ¥
# ============================================================================
# åŸºç¡€å·¥å…·æ›¿æ¢
if command -v eza &> /dev/null; then
    alias list='eza --icons --group-directories-first'
    alias list_long='eza -l --icons --group-directories-first --time-style=long-iso'
    alias list_all='eza -la --icons --group-directories-first --time-style=long-iso'
    alias list_tree='eza --tree --level=2 --icons'
    alias list_tree_all='eza --tree --level=2 --icons -a'
elif command -v exa &> /dev/null; then
    alias list='exa --icons --group-directories-first'
    alias list_long='exa -l --icons --group-directories-first --time-style=long-iso'
    alias list_all='exa -la --icons --group-directories-first --time-style=long-iso'
    alias list_tree='exa --tree --level=2 --icons'
    alias list_tree_all='exa --tree --level=2 --icons -a'
fi

if command -v bat &> /dev/null; then
    alias show_file='bat --paging=never'
    alias view_file='bat'
fi

if command -v fd &> /dev/null; then
    alias search_files='fd'
fi

if command -v rg &> /dev/null; then
    alias search_text='rg'
fi

# Git å¢å¼ºåˆ«å
alias git_status='git status'
alias git_checkout='git checkout'
alias git_checkout_branch='git checkout -b'
alias git_add_all='git add .'
alias git_commit_message='git commit -m'
alias git_push='git push'
alias git_pull='git pull'
alias git_log_graph='git log --oneline --graph --decorate --all'
alias git_diff='git diff'
alias git_stash='git stash'
alias git_stash_pop='git stash pop'

# ç³»ç»Ÿåˆ«å
alias go_parent='cd ..'
alias go_grandparent='cd ../..'
alias go_great_grandparent='cd ../../..'
alias go_home='cd ~'
alias go_previous='cd -'

# å®ç”¨åˆ«å
alias show_history='history'
alias show_jobs='jobs'
alias clear_screen='clear'
alias exit_shell='exit'
alias reload_shell='source ~/.zshrc'
alias edit_zshrc='code ~/.zshrc'

# ç½‘ç»œå·¥å…·
alias myip='curl -s https://ipinfo.io/ip'
alias localip='ipconfig getifaddr en0'
alias ports='lsof -i -P -n | grep LISTEN'

# ç³»ç»Ÿç›‘æ§
alias cpu='top -o cpu'
alias mem='top -o rsize'
alias disk='df -h'
alias temp='sudo powermetrics --samplers smc -n 1 -i 1000 | grep -i temp'

# ç¯å¢ƒç®¡ç†åˆ«å
alias pyenv='show_python_envs'
alias nodeenv='show_node_info'
alias envinfo='show_env_status'
alias envbrief='show_env_brief'

# ============================================================================
# æ™ºèƒ½å‡½æ•° - ä¸Šä¸‹æ–‡æ„ŸçŸ¥æç¤º
# ============================================================================
# æ™ºèƒ½ cd å‡½æ•°
cd() {
    builtin cd "$@"

    # æ˜¾ç¤ºç›®å½•å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸å¤šï¼‰
    local file_count=$(ls -1 2>/dev/null | wc -l)
    if [[ $file_count -le 20 ]] && [[ $file_count -gt 0 ]]; then
        echo ""
        if command -v eza &> /dev/null; then
            eza --icons --group-directories-first
        elif command -v exa &> /dev/null; then
            exa --icons --group-directories-first
        else
            ls -la
        fi
    fi

    echo ""

    # æ˜¾ç¤ºå½“å‰ç¯å¢ƒä¿¡æ¯
    local env_brief=$(show_env_brief)
    if [[ -n "$env_brief" ]]; then
        echo "ğŸŒŸ ç¯å¢ƒ: $env_brief"
    fi

    # æ£€æŸ¥æ˜¯å¦æ˜¯ Git ä»“åº“
    if git rev-parse --git-dir > /dev/null 2>&1; then
        echo "ğŸ“ Git ä»“åº“: $(basename $(git rev-parse --show-toplevel))"
        echo "ğŸŒ¿ åˆ†æ”¯: $(git branch --show-current)"

        # æ˜¾ç¤ºçŠ¶æ€ï¼ˆå¦‚æœæœ‰å˜æ›´ï¼‰
        local git_status=$(git status --porcelain 2>/dev/null)
        if [[ -n "$git_status" ]]; then
            local changes=$(echo "$git_status" | wc -l | tr -d ' ')
            echo "ğŸ“ æœ‰ $changes ä¸ªæœªæäº¤çš„æ›´æ”¹"
        else
            echo "âœ… å·¥ä½œåŒºå¹²å‡€"
        fi
    fi

    # æ£€æŸ¥é¡¹ç›®ç±»å‹å’Œç»™å‡ºå»ºè®®
    local suggestions=()

    # Python é¡¹ç›®æ£€æµ‹
    if [[ -f "requirements.txt" ]] || [[ -f "pyproject.toml" ]] || [[ -f "Pipfile" ]] || [[ -f "setup.py" ]]; then
        echo "ğŸ æ£€æµ‹åˆ° Python é¡¹ç›®"
        if [[ -z "$VIRTUAL_ENV" ]] && [[ -z "$CONDA_DEFAULT_ENV" || "$CONDA_DEFAULT_ENV" == "base" ]]; then
            suggestions+=("æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ")
        fi
        if [[ -f "requirements.txt" ]] && [[ -z "$VIRTUAL_ENV" ]]; then
            suggestions+=("pip install -r requirements.txt")
        fi
    fi

    # Node.js é¡¹ç›®æ£€æµ‹
    if [[ -f "package.json" ]]; then
        echo "ğŸ“¦ æ£€æµ‹åˆ° Node.js é¡¹ç›®"
        if [[ ! -d "node_modules" ]]; then
            suggestions+=("npm install")
        fi
        # æ£€æŸ¥æ˜¯å¦æœ‰å¯åŠ¨è„šæœ¬
        if command -v jq &> /dev/null && [[ -f "package.json" ]]; then
            local start_script=$(jq -r '.scripts.start // empty' package.json 2>/dev/null)
            if [[ -n "$start_script" ]]; then
                suggestions+=("npm start")
            fi
        fi
    fi

    # Docker é¡¹ç›®æ£€æµ‹
    if [[ -f "Dockerfile" ]]; then
        echo "ğŸ³ æ£€æµ‹åˆ° Docker é¡¹ç›®"
        suggestions+=("docker build -t \$(basename \$(pwd)) .")
    fi

    if [[ -f "docker-compose.yml" ]] || [[ -f "docker-compose.yaml" ]]; then
        echo "ğŸ³ æ£€æµ‹åˆ° Docker Compose é¡¹ç›®"
        suggestions+=("docker-compose up")
    fi

    # Rust é¡¹ç›®æ£€æµ‹
    if [[ -f "Cargo.toml" ]]; then
        echo "ğŸ¦€ æ£€æµ‹åˆ° Rust é¡¹ç›®"
        suggestions+=("cargo build" "cargo run")
    fi

    # Go é¡¹ç›®æ£€æµ‹
    if [[ -f "go.mod" ]]; then
        echo "ğŸ”· æ£€æµ‹åˆ° Go é¡¹ç›®"
        suggestions+=("go build" "go run .")
    fi

    # æ˜¾ç¤ºå»ºè®®
    if [[ ${#suggestions[@]} -gt 0 ]]; then
        echo "ğŸ’¡ å»ºè®®çš„æ“ä½œ:"
        for suggestion in "${suggestions[@]}"; do
            echo "   â€¢ $suggestion"
        done
    fi

    echo ""
}

# æ™ºèƒ½åˆ›å»ºç›®å½•å¹¶è¿›å…¥
mkcd() {
    mkdir -p "$1" && cd "$1"
}

# åˆ›å»ºç›®å½•å¹¶è¿›å…¥ï¼ˆå®Œæ•´å‘½ä»¤ç‰ˆæœ¬ï¼‰
make_directory_and_enter() {
    if [[ -z "$1" ]]; then
        echo "ç”¨æ³•: make_directory_and_enter <ç›®å½•åç§°>"
        return 1
    fi
    
    local dir_name="$1"
    
    echo "åˆ›å»ºç›®å½•: $dir_name"
    if mkdir -p "$dir_name"; then
        echo "è¿›å…¥ç›®å½•: $dir_name"
        builtin cd "$dir_name" || return
        echo "ğŸ“ å½“å‰ä½ç½®: $(pwd)"
    else
        echo "âŒ åˆ›å»ºç›®å½•å¤±è´¥: $dir_name"
        return 1
    fi
}

# åˆ›å»ºç›®å½•å¹¶è¿›å…¥ï¼ˆå®Œæ•´å‘½ä»¤ç‰ˆæœ¬ï¼‰
make_directory_and_enter() {
    if [[ -z "$1" ]]; then
        echo "ç”¨æ³•: make_directory_and_enter <ç›®å½•åç§°>"
        return 1
    fi
    
    local dir_name="$1"
    
    echo "åˆ›å»ºç›®å½•: $dir_name"
    if mkdir -p "$dir_name"; then
        echo "è¿›å…¥ç›®å½•: $dir_name"
        builtin cd "$dir_name" || return
        echo "ğŸ“ å½“å‰ä½ç½®: $(pwd)"
    else
        echo "âŒ åˆ›å»ºç›®å½•å¤±è´¥: $dir_name"
        return 1
    fi
}

# æœç´¢æ–‡ä»¶å†…å®¹å‡½æ•°
search_content() {
    if [[ -z "$1" ]]; then
        echo "ç”¨æ³•: search_content <æœç´¢è¯> [ç›®å½•]"
        return 1
    fi

    local search_term="$1"
    local search_dir="${2:-.}"

    if command -v rg &> /dev/null; then
        rg --color=always --heading --line-number "$search_term" "$search_dir"
    else
        grep -r --color=always -n "$search_term" "$search_dir"
    fi
}

# æŸ¥æ‰¾æ–‡ä»¶å‡½æ•°
find_file_by_name() {
    if [[ -z "$1" ]]; then
        echo "ç”¨æ³•: find_file_by_name <æ–‡ä»¶åæ¨¡å¼>"
        return 1
    fi

    if command -v fd &> /dev/null; then
        fd "$1"
    else
        find . -name "*$1*" -type f
    fi
}

# å†å²å‘½ä»¤æœç´¢å‡½æ•°
fuzzy_history_search() {
    if command -v fzf &> /dev/null; then
        local selected_command=$(history | fzf --tac --no-sort --height 40% --reverse --border --inline-info | sed 's/^[ ]*[0-9]*[ ]*//')
        if [[ -n "$selected_command" ]]; then
            print -z "$selected_command"
        fi
    else
        echo "âŒ éœ€è¦å®‰è£… fzf æ¥ä½¿ç”¨æ­¤åŠŸèƒ½: brew install fzf"
        return 1
    fi
}

# æœç´¢æ–‡ä»¶å†…å®¹ï¼ˆå®Œæ•´å‘½ä»¤ç‰ˆæœ¬ï¼‰
search_files() {
    if [[ -z "$1" ]]; then
        echo "ç”¨æ³•: search_files <æœç´¢è¯> [æ–‡ä»¶ç±»å‹]"
        return 1
    fi
    
    local search_term="$1"
    local file_type="${2:-}"
    
    echo "ğŸ” æœç´¢æ–‡ä»¶å†…å®¹: '$search_term'"
    
    if [[ -n "$file_type" ]]; then
        echo "æ–‡ä»¶ç±»å‹: '$file_type'"
    fi
    
    if command -v rg &> /dev/null; then
        if [[ -n "$file_type" ]]; then
            rg --color=always --line-number --heading "$search_term" --type "$file_type"
        else
            rg --color=always --line-number --heading "$search_term"
        fi
    elif command -v ag &> /dev/null; then
        if [[ -n "$file_type" ]]; then
            ag --color --line-number --heading "$search_term" --type "$file_type"
        else
            ag --color --line-number --heading "$search_term"
        fi
    else
        if [[ -n "$file_type" ]]; then
            find . -type f -name "*.$file_type" -exec grep -l "$search_term" {} \; | while read file; do
                echo "==> $file <=="
                grep -n --color=always "$search_term" "$file"
            done
        else
            grep -r --color=always -n "$search_term" .
        fi
    fi
}

# å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶
ff() {
    if [[ -z "$1" ]]; then
        echo "ç”¨æ³•: ff <æ–‡ä»¶åæ¨¡å¼>"
        return 1
    fi

    if command -v fd &> /dev/null; then
        fd "$1"
    else
        find . -name "*$1*" -type f
    fi
}

# æŸ¥æ‰¾æ–‡ä»¶ï¼ˆå®Œæ•´å‘½ä»¤ç‰ˆæœ¬ï¼‰
find_files() {
    if [[ -z "$1" ]]; then
        echo "ç”¨æ³•: find_files <æ–‡ä»¶åæ¨¡å¼> [æœç´¢ç›®å½•]"
        return 1
    fi
    
    local file_pattern="$1"
    local search_dir="${2:-.}"
    
    echo "ğŸ” æŸ¥æ‰¾æ–‡ä»¶: '$file_pattern'"
    echo "æœç´¢ç›®å½•: '$search_dir'"
    
    if command -v fd &> /dev/null; then
        fd "$file_pattern" "$search_dir"
    elif command -v find &> /dev/null; then
        find "$search_dir" -type f -iname "*$file_pattern*"
    else
        echo "âŒ æœªæ‰¾åˆ° find æˆ– fd å‘½ä»¤"
        return 1
    fi
}

# æ™ºèƒ½å†å²æœç´¢å‡½æ•°
fh() {
    if command -v fzf &> /dev/null; then
        local selected_command=$(history | fzf --tac --no-sort --height 40% --reverse --border --inline-info | sed 's/^[ ]*[0-9]*[ ]*//')
        if [[ -n "$selected_command" ]]; then
            print -z "$selected_command"
        fi
    else
        echo "âŒ éœ€è¦å®‰è£… fzf æ¥ä½¿ç”¨æ­¤åŠŸèƒ½: brew install fzf"
        return 1
    fi
}

# æœç´¢å‘½ä»¤å†å²ï¼ˆå®Œæ•´å‘½ä»¤ç‰ˆæœ¬ï¼‰
search_history() {
    if command -v fzf &> /dev/null; then
        echo "ğŸ” æœç´¢å‘½ä»¤å†å²..."
        local selected_command=$(history | fzf --tac --no-sort --height 50% --reverse --border --inline-info --prompt="å†å²å‘½ä»¤> " | sed 's/^[ ]*[0-9]*[ ]*//')
        if [[ -n "$selected_command" ]]; then
            echo "é€‰æ‹©çš„å‘½ä»¤: $selected_command"
            print -z "$selected_command"
        fi
    else
        echo "âŒ éœ€è¦å®‰è£… fzf æ¥ä½¿ç”¨æ­¤åŠŸèƒ½"
        echo "å®‰è£…å‘½ä»¤: brew install fzf"
        return 1
    fi
}

# è¿›ç¨‹æŸ¥æ‰¾å’Œç®¡ç†å‡½æ•°
fuzzy_process_kill() {
    if command -v fzf &> /dev/null; then
        local pid=$(ps -ef | sed 1d | fzf -m | awk '{print $2}')
        if [[ -n "$pid" ]]; then
            echo "ç»ˆæ­¢è¿›ç¨‹: $pid"
            kill -9 "$pid"
        fi
    else
        echo "éœ€è¦å®‰è£… fzf æ¥ä½¿ç”¨æ­¤åŠŸèƒ½"
    fi
}

# æŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹ï¼ˆå®Œæ•´å‘½ä»¤ç‰ˆæœ¬ï¼‰
find_and_kill_process() {
    if command -v fzf &> /dev/null; then
        echo "ğŸ” é€‰æ‹©è¦ç»ˆæ­¢çš„è¿›ç¨‹:"
        local pid=$(ps aux | sed 1d | fzf --multi --height 50% --reverse --border --prompt="é€‰æ‹©è¿›ç¨‹> " | awk '{print $2}')
        if [[ -n "$pid" ]]; then
            echo "å‡†å¤‡ç»ˆæ­¢è¿›ç¨‹: $pid"
            echo -n "ç¡®è®¤ç»ˆæ­¢è¿™äº›è¿›ç¨‹å—? [y/N]: "
            read -q confirm
            echo
            if [[ "$confirm" =~ ^[Yy]$ ]]; then
                echo "æ­£åœ¨ç»ˆæ­¢è¿›ç¨‹..."
                kill -9 $pid
                echo "è¿›ç¨‹å·²ç»ˆæ­¢"
            else
                echo "æ“ä½œå·²å–æ¶ˆ"
            fi
        fi
    else
        echo "âŒ éœ€è¦å®‰è£… fzf æ¥ä½¿ç”¨æ­¤åŠŸèƒ½"
        echo "å®‰è£…å‘½ä»¤: brew install fzf"
        return 1
    fi
}

# å¿«é€Ÿç¼–è¾‘é…ç½®æ–‡ä»¶
edit_config() {
    local config_files=(
        "~/.zshrc:Zshé…ç½®"
        "~/.gitconfig:Gité…ç½®"
        "~/.condarc:Condaé…ç½®"
        "~/Library/Application Support/Code/User/settings.json:VS Codeè®¾ç½®"
    )

    echo "é€‰æ‹©è¦ç¼–è¾‘çš„é…ç½®æ–‡ä»¶:"
    for i in {1..${#config_files[@]}}; do
        local file_info="${config_files[$i]}"
        local file_path="${file_info%%:*}"
        local file_desc="${file_info##*:}"
        echo "$i) $file_desc ($file_path)"
    done

    read -p "è¯·é€‰æ‹© (1-${#config_files[@]}): " choice

    if [[ "$choice" =~ ^[1-9][0-9]*$ ]] && [[ "$choice" -le "${#config_files[@]}" ]]; then
        local selected="${config_files[$choice]}"
        local file_path="${selected%%:*}"
        local expanded_path="${file_path/#\~/$HOME}"

        if [[ -f "$expanded_path" ]]; then
            $EDITOR "$expanded_path"
        else
            echo "æ–‡ä»¶ä¸å­˜åœ¨: $expanded_path"
        fi
    else
        echo "æ— æ•ˆé€‰æ‹©"
    fi
}

# é¡¹ç›®å¿«é€Ÿå¯åŠ¨å‡½æ•°
project() {
    local project_dir="$HOME/Projects"

    if [[ ! -d "$project_dir" ]]; then
        echo "é¡¹ç›®ç›®å½•ä¸å­˜åœ¨: $project_dir"
        return 1
    fi

    if command -v fzf &> /dev/null; then
        local selected_project=$(find "$project_dir" -maxdepth 2 -type d | fzf --preview 'ls -la {}')
        if [[ -n "$selected_project" ]]; then
            cd "$selected_project"
        fi
    else
        echo "å¯ç”¨é¡¹ç›®:"
        ls -la "$project_dir"
    fi
}

# ç³»ç»Ÿä¿¡æ¯æ˜¾ç¤º
sysinfo() {
    echo "ğŸ–¥ï¸  ç³»ç»Ÿä¿¡æ¯"
    echo "============"
    echo "ç³»ç»Ÿ: $(uname -s)"
    echo "ç‰ˆæœ¬: $(sw_vers -productVersion)"
    echo "æ¶æ„: $(uname -m)"
    echo "ä¸»æœº: $(hostname)"
    echo "ç”¨æˆ·: $(whoami)"
    echo "Shell: $SHELL"
    echo "ç»ˆç«¯: $TERM"
    echo ""
    echo "ğŸ’¾ å†…å­˜ä½¿ç”¨:"
    vm_stat | grep -E "(free|active|inactive|wired)" | awk '{print $1 " " $3}' | sed 's/://g'
    echo ""
    echo "ğŸ’¿ ç£ç›˜ä½¿ç”¨:"
    df -h / | tail -1 | awk '{print "æ ¹ç›®å½•: " $3 " / " $2 " (" $5 " å·²ä½¿ç”¨)"}'
    echo ""
    echo "ğŸŒ¡ï¸  CPU ä¿¡æ¯:"
    sysctl -n machdep.cpu.brand_string
}

# ç½‘ç»œè¿æ¥æµ‹è¯•
nettest() {
    echo "ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•"
    echo "==============="

    local sites=("google.com" "github.com" "stackoverflow.com")

    for site in "${sites[@]}"; do
        if ping -c 1 "$site" &> /dev/null; then
            echo "âœ… $site - è¿æ¥æ­£å¸¸"
        else
            echo "âŒ $site - è¿æ¥å¤±è´¥"
        fi
    done

    echo ""
    echo "ğŸ“¡ æœ¬æœº IP åœ°å€:"
    echo "å†…ç½‘ IP: $(ipconfig getifaddr en0 2>/dev/null || echo 'æœªè¿æ¥')"
    echo "å¤–ç½‘ IP: $(curl -s https://ipinfo.io/ip 2>/dev/null || echo 'è·å–å¤±è´¥')"
}

# ============================================================================
# å‘½ä»¤è®°å¿†å’Œç»Ÿè®¡åŠŸèƒ½
# ============================================================================
# å‘½ä»¤ä½¿ç”¨ç»Ÿè®¡
cmd_stats() {
    echo "ğŸ“Š æœ€å¸¸ç”¨çš„å‘½ä»¤ (Top 20):"
    echo "========================"
    history | awk '{print $2}' | sort | uniq -c | sort -nr | head -20 | \
    awk '{printf "%3d. %-15s (%d æ¬¡)\n", NR, $2, $1}'
}

# ä»Šæ—¥å‘½ä»¤ç»Ÿè®¡
today_stats() {
    local today=$(date +%Y-%m-%d)
    echo "ğŸ“… ä»Šæ—¥å‘½ä»¤ç»Ÿè®¡ ($today):"
    echo "========================"

    # ä»å†å²è®°å½•ä¸­æå–ä»Šæ—¥çš„å‘½ä»¤
    history | grep "$(date +%Y-%m-%d)" | awk '{print $4}' | sort | uniq -c | sort -nr | head -10 | \
    awk '{printf "%3d. %-15s (%d æ¬¡)\n", NR, $2, $1}'
}

# ============================================================================
# ç¯å¢ƒç®¡ç†ä¸“ç”¨å‡½æ•°
# ============================================================================
# æ˜¾ç¤º Python ç¯å¢ƒä¿¡æ¯
show_python_envs() {
    echo "ğŸ Python ç¯å¢ƒä¿¡æ¯:"
    echo "=================="

    # å½“å‰ Python ç‰ˆæœ¬
    if command -v python &> /dev/null; then
        echo "å½“å‰ Python: $(python --version) ($(which python))"
    else
        echo "å½“å‰ Python: æœªå®‰è£…"
    fi

    # è™šæ‹Ÿç¯å¢ƒçŠ¶æ€
    if [[ -n "$VIRTUAL_ENV" ]]; then
        echo "è™šæ‹Ÿç¯å¢ƒ: $(basename $VIRTUAL_ENV) âœ…"
        echo "ç¯å¢ƒè·¯å¾„: $VIRTUAL_ENV"
    else
        echo "è™šæ‹Ÿç¯å¢ƒ: æœªæ¿€æ´»"
    fi

    # Conda ç¯å¢ƒçŠ¶æ€
    if command -v conda &> /dev/null; then
        echo "Conda ç¯å¢ƒ: ${CONDA_DEFAULT_ENV:-æœªæ¿€æ´»}"
        if [[ -n "$CONDA_DEFAULT_ENV" ]]; then
            echo "å¯ç”¨ç¯å¢ƒ:"
            conda env list | grep -v "^#" | sed 's/^/  /'
        fi
    fi

    # æ£€æŸ¥å¸¸ç”¨ Python åŒ…
    if command -v pip &> /dev/null; then
        echo ""
        echo "å·²å®‰è£…çš„é‡è¦åŒ…:"
        for pkg in numpy pandas matplotlib requests flask django; do
            if pip show "$pkg" &> /dev/null; then
                local version=$(pip show "$pkg" | grep Version | cut -d' ' -f2)
                echo "  âœ… $pkg ($version)"
            else
                echo "  âŒ $pkg"
            fi
        done
    fi
}

# æ˜¾ç¤º Node.js ç¯å¢ƒä¿¡æ¯
show_node_info() {
    echo "ğŸ“¦ Node.js ç¯å¢ƒä¿¡æ¯:"
    echo "==================="

    if command -v node &> /dev/null; then
        echo "Node.js: $(node --version)"
        echo "npm: $(npm --version)"
        echo "å®‰è£…è·¯å¾„: $(which node)"

        # æ˜¾ç¤ºå…¨å±€åŒ…
        echo ""
        echo "å…¨å±€å®‰è£…çš„åŒ…:"
        npm list -g --depth=0 2>/dev/null | head -10 | sed 's/^/  /'

        # å¦‚æœåœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œæ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
        if [[ -f "package.json" ]]; then
            echo ""
            echo "å½“å‰é¡¹ç›®ä¿¡æ¯:"
            if command -v jq &> /dev/null; then
                local name=$(jq -r '.name // "æœªå‘½å"' package.json)
                local version=$(jq -r '.version // "æœªçŸ¥"' package.json)
                echo "  é¡¹ç›®å: $name"
                echo "  ç‰ˆæœ¬: $version"

                # æ˜¾ç¤ºå¯ç”¨è„šæœ¬
                local scripts=$(jq -r '.scripts | keys[]' package.json 2>/dev/null)
                if [[ -n "$scripts" ]]; then
                    echo "  å¯ç”¨è„šæœ¬:"
                    echo "$scripts" | sed 's/^/    â€¢ npm run /'
                fi
            fi
        fi
    else
        echo "Node.js: æœªå®‰è£…"
        echo "å»ºè®®å®‰è£…: brew install node"
    fi
}

# å¿«é€Ÿåˆ‡æ¢ Python ç¯å¢ƒ
switch_python_env() {
    if [[ -z "$1" ]]; then
        echo "ç”¨æ³•: switch_python_env <ç¯å¢ƒå>"
        echo "å¯ç”¨ç¯å¢ƒ:"
        if command -v conda &> /dev/null; then
            conda env list
        fi
        return 1
    fi

    local env_name="$1"

    # å°è¯•æ¿€æ´» Conda ç¯å¢ƒ
    if command -v conda &> /dev/null; then
        if conda env list | grep -q "^$env_name "; then
            conda activate "$env_name"
            echo "âœ… å·²æ¿€æ´» Conda ç¯å¢ƒ: $env_name"
            return 0
        fi
    fi

    # å°è¯•æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
    local venv_paths=("$HOME/.virtualenvs/$env_name" "$HOME/venvs/$env_name" "./$env_name")
    for venv_path in "${venv_paths[@]}"; do
        if [[ -f "$venv_path/bin/activate" ]]; then
            source "$venv_path/bin/activate"
            echo "âœ… å·²æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ: $env_name"
            return 0
        fi
    done

    echo "âŒ æœªæ‰¾åˆ°ç¯å¢ƒ: $env_name"
    return 1
}

# åˆ›å»ºæ–°çš„ Python è™šæ‹Ÿç¯å¢ƒ
create_venv() {
    local env_name="${1:-venv}"
    local python_version="${2:-python3}"

    echo "åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ: $env_name"

    if command -v "$python_version" &> /dev/null; then
        "$python_version" -m venv "$env_name"
        echo "âœ… è™šæ‹Ÿç¯å¢ƒåˆ›å»ºæˆåŠŸ: $env_name"
        echo "æ¿€æ´»å‘½ä»¤: source $env_name/bin/activate"
    else
        echo "âŒ Python ç‰ˆæœ¬ä¸å­˜åœ¨: $python_version"
    fi
}

# ============================================================================
# è‡ªå®šä¹‰æç¤ºç¬¦å¢å¼º - åœ¨å³ä¾§æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
# ============================================================================
# è‡ªå®šä¹‰å³ä¾§æç¤ºç¬¦å‡½æ•°
custom_rprompt() {
    local env_info=""

    # Python ç¯å¢ƒä¿¡æ¯
    if [[ -n "$VIRTUAL_ENV" ]]; then
        env_info+="%F{green}ğŸ$(basename $VIRTUAL_ENV)%f "
    elif [[ -n "$CONDA_DEFAULT_ENV" ]] && [[ "$CONDA_DEFAULT_ENV" != "base" ]]; then
        env_info+="%F{green}ğŸ$CONDA_DEFAULT_ENV%f "
    fi

    # Node.js ç‰ˆæœ¬ï¼ˆå¦‚æœåœ¨ Node.js é¡¹ç›®ä¸­ï¼‰
    if [[ -f "package.json" ]] && command -v node &> /dev/null; then
        local node_version=$(node --version | sed 's/v//')
        env_info+="%F{cyan}ğŸ“¦$node_version%f "
    fi

    # æ˜¾ç¤ºå½“å‰æ—¶é—´
    env_info+="%F{yellow}%D{%H:%M:%S}%f"

    echo "$env_info"
}

# è®¾ç½®å³ä¾§æç¤ºç¬¦ï¼ˆå¦‚æœä¸ä½¿ç”¨ Powerlevel10kï¼‰
if [[ "$ZSH_THEME" != "powerlevel10k/powerlevel10k" ]]; then
    RPS1='$(custom_rprompt)'
fi

# ============================================================================
# ç¯å¢ƒå˜é‡ç›‘æ§ - è‡ªåŠ¨æ˜¾ç¤ºç¯å¢ƒå˜åŒ–
# ============================================================================
# ç›‘æ§ç¯å¢ƒå˜åŒ–çš„å‡½æ•°
check_env_changes() {
    # æ£€æŸ¥ Python ç¯å¢ƒå˜åŒ–
    if [[ "$LAST_PYTHON_ENV" != "$VIRTUAL_ENV$CONDA_DEFAULT_ENV" ]]; then
        if [[ -n "$VIRTUAL_ENV" ]]; then
            echo "ğŸ å·²æ¿€æ´» Python è™šæ‹Ÿç¯å¢ƒ: $(basename $VIRTUAL_ENV)"
        elif [[ -n "$CONDA_DEFAULT_ENV" ]] && [[ "$CONDA_DEFAULT_ENV" != "base" ]]; then
            echo "ğŸ å·²æ¿€æ´» Conda ç¯å¢ƒ: $CONDA_DEFAULT_ENV"
        elif [[ -n "$LAST_PYTHON_ENV" ]]; then
            echo "ğŸ å·²é€€å‡º Python ç¯å¢ƒ"
        fi
        export LAST_PYTHON_ENV="$VIRTUAL_ENV$CONDA_DEFAULT_ENV"
    fi
}

# åœ¨æ¯ä¸ªå‘½ä»¤æ‰§è¡Œå‰æ£€æŸ¥ç¯å¢ƒå˜åŒ–
precmd_functions+=(check_env_changes)

# ============================================================================
# é”®ç›˜ç»‘å®š - å¢å¼ºäº¤äº’ä½“éªŒ
# ============================================================================
# Ctrl+R: ä½¿ç”¨ fzf è¿›è¡Œå†å²æœç´¢
if command -v fzf &> /dev/null; then
    bindkey '^R' fzf-history-widget
fi

# Ctrl+T: ä½¿ç”¨ fzf é€‰æ‹©æ–‡ä»¶
if command -v fzf &> /dev/null; then
    bindkey '^T' fzf-file-widget
fi

# Alt+C: ä½¿ç”¨ fzf é€‰æ‹©ç›®å½•
if command -v fzf &> /dev/null; then
    bindkey '\ec' fzf-cd-widget
fi

# Ctrl+X Ctrl+E: åœ¨ç¼–è¾‘å™¨ä¸­ç¼–è¾‘å‘½ä»¤è¡Œ
autoload -U edit-command-line
zle -N edit-command-line
bindkey '^X^E' edit-command-line

# ============================================================================
# ç¯å¢ƒä¿¡æ¯æ˜¾ç¤ºå‡½æ•°
# ============================================================================
# æ˜¾ç¤ºå½“å‰ç¯å¢ƒä¿¡æ¯
show_env_status() {
    echo "ğŸŒŸ å½“å‰ç¯å¢ƒçŠ¶æ€:"
    echo "==============="

    # Python ç¯å¢ƒä¿¡æ¯
    if command -v python &> /dev/null; then
        local python_version=$(python --version 2>&1 | cut -d' ' -f2)
        local python_path=$(which python)
        echo "ğŸ Python: $python_version ($python_path)"

        # æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
        if [[ -n "$VIRTUAL_ENV" ]]; then
            echo "   è™šæ‹Ÿç¯å¢ƒ: $(basename $VIRTUAL_ENV)"
        elif [[ -n "$CONDA_DEFAULT_ENV" ]]; then
            echo "   Conda ç¯å¢ƒ: $CONDA_DEFAULT_ENV"
        else
            echo "   ç¯å¢ƒ: ç³»ç»Ÿé»˜è®¤"
        fi
    else
        echo "ğŸ Python: æœªå®‰è£…"
    fi

    # Node.js ç¯å¢ƒä¿¡æ¯
    if command -v node &> /dev/null; then
        local node_version=$(node --version)
        echo "ğŸ“¦ Node.js: $node_version"

        if command -v npm &> /dev/null; then
            local npm_version=$(npm --version)
            echo "   npm: $npm_version"
        fi
    fi

    # Go ç¯å¢ƒä¿¡æ¯
    if command -v go &> /dev/null; then
        local go_version=$(go version | cut -d' ' -f3)
        echo "ğŸ”· Go: $go_version"
    fi

    # Rust ç¯å¢ƒä¿¡æ¯
    if command -v rustc &> /dev/null; then
        local rust_version=$(rustc --version | cut -d' ' -f2)
        echo "ğŸ¦€ Rust: $rust_version"
    fi

    # Java ç¯å¢ƒä¿¡æ¯
    if command -v java &> /dev/null; then
        local java_version=$(java -version 2>&1 | head -n1 | cut -d'"' -f2)
        echo "â˜• Java: $java_version"
    fi

    # Git ä¿¡æ¯
    if command -v git &> /dev/null; then
        local git_version=$(git --version | cut -d' ' -f3)
        echo "ğŸ“š Git: $git_version"

        # å¦‚æœåœ¨ Git ä»“åº“ä¸­ï¼Œæ˜¾ç¤ºä»“åº“ä¿¡æ¯
        if git rev-parse --git-dir > /dev/null 2>&1; then
            echo "   ä»“åº“: $(basename $(git rev-parse --show-toplevel))"
            echo "   åˆ†æ”¯: $(git branch --show-current)"
            local git_status=$(git status --porcelain 2>/dev/null)
            if [[ -n "$git_status" ]]; then
                echo "   çŠ¶æ€: æœ‰æœªæäº¤çš„æ›´æ”¹"
            else
                echo "   çŠ¶æ€: å·¥ä½œåŒºå¹²å‡€"
            fi
        fi
    fi

    # ç³»ç»Ÿä¿¡æ¯
    echo "ğŸ’» ç³»ç»Ÿ: $(uname -s) $(uname -r)"
    echo "ğŸ  ä¸»ç›®å½•: $HOME"
    echo "ğŸ“‚ å½“å‰ç›®å½•: $(pwd)"
    echo ""
}

# ç®€åŒ–çš„ç¯å¢ƒä¿¡æ¯æ˜¾ç¤ºï¼ˆç”¨äºæç¤ºç¬¦ï¼‰
show_env_brief() {
    local env_info=""

    # Python ç¯å¢ƒ
    if command -v python &> /dev/null; then
        local python_version=$(python --version 2>&1 | cut -d' ' -f2 | cut -d'.' -f1,2)
        if [[ -n "$VIRTUAL_ENV" ]]; then
            env_info+="ğŸ $(basename $VIRTUAL_ENV) (py$python_version) "
        elif [[ -n "$CONDA_DEFAULT_ENV" ]] && [[ "$CONDA_DEFAULT_ENV" != "base" ]]; then
            env_info+="ğŸ $CONDA_DEFAULT_ENV (py$python_version) "
        fi
    fi

    # Node.js ç¯å¢ƒ
    if [[ -f "package.json" ]] && command -v node &> /dev/null; then
        local node_version=$(node --version | cut -d'.' -f1 | sed 's/v//')
        env_info+="ğŸ“¦ node$node_version "
    fi

    # Git åˆ†æ”¯
    if git rev-parse --git-dir > /dev/null 2>&1; then
        local branch=$(git branch --show-current)
        local git_status=$(git status --porcelain 2>/dev/null)
        if [[ -n "$git_status" ]]; then
            env_info+="ğŸŒ¿ $branch* "
        else
            env_info+="ğŸŒ¿ $branch "
        fi
    fi

    if [[ -n "$env_info" ]]; then
        echo "$env_info"
    fi
}

# ============================================================================
# å¯åŠ¨æ—¶çš„æ¬¢è¿ä¿¡æ¯å’Œæç¤º
# ============================================================================
# æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯ï¼ˆä»…åœ¨äº¤äº’å¼ shell ä¸­ï¼‰
if [[ $- == *i* ]]; then
    # æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çš„ç»ˆç«¯ä¼šè¯
    if [[ -z "$TMUX" ]] && [[ "$TERM_PROGRAM" != "vscode" ]]; then
        echo ""
        echo "ğŸš€ ç»ˆç«¯å¢å¼ºåŠŸèƒ½å·²åŠ è½½ï¼"
        echo ""

        # æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
        show_env_brief

        echo "ğŸ’¡ å¿«æ·åŠŸèƒ½:"
        echo "  â€¢ fuzzy_history_search     - å†å²å‘½ä»¤æœç´¢"
        echo "  â€¢ find_file_by_name        - æŒ‰åç§°æŸ¥æ‰¾æ–‡ä»¶"
        echo "  â€¢ search_content           - æœç´¢æ–‡ä»¶å†…å®¹"
        echo "  â€¢ fuzzy_process_kill       - è¿›ç¨‹ç®¡ç†"
        echo "  â€¢ project                  - å¿«é€Ÿåˆ‡æ¢é¡¹ç›®"
        echo "  â€¢ sysinfo                  - ç³»ç»Ÿä¿¡æ¯"
        echo "  â€¢ nettest                  - ç½‘ç»œæµ‹è¯•"
        echo "  â€¢ cmd_stats                - å‘½ä»¤ç»Ÿè®¡"
        echo ""
        echo "ğŸŒŸ ç¯å¢ƒç®¡ç†:"
        echo "  â€¢ show_env_status - æ˜¾ç¤ºè¯¦ç»†ç¯å¢ƒä¿¡æ¯"
        echo "  â€¢ pyenv           - Python ç¯å¢ƒä¿¡æ¯"
        echo "  â€¢ nodeenv         - Node.js ç¯å¢ƒä¿¡æ¯"
        echo "  â€¢ switch_python_env <åç§°> - åˆ‡æ¢ Python ç¯å¢ƒ"
        echo "  â€¢ create_venv <åç§°> - åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"
        echo ""
        echo "âŒ¨ï¸  å¿«æ·é”®:"
        echo "  â€¢ Ctrl+R   - å†å²æœç´¢"
        echo "  â€¢ Ctrl+T   - æ–‡ä»¶é€‰æ‹©"
        echo "  â€¢ Alt+C    - ç›®å½•é€‰æ‹©"
        echo "  â€¢ â†‘/â†“      - å†å²å­ä¸²æœç´¢"
        echo ""
    fi
fi

# ============================================================================
# Powerlevel10k é…ç½®
# ============================================================================
# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# ============================================================================
# æ¡ä»¶åŠ è½½ - æ€§èƒ½ä¼˜åŒ–
# ============================================================================
# å»¶è¿ŸåŠ è½½é‡å‹æ’ä»¶
lazy_load() {
    local plugin_name="$1"
    local plugin_path="$2"

    if [[ -f "$plugin_path" ]]; then
        eval "$plugin_name() { unfunction $plugin_name; source $plugin_path; $plugin_name \$@ }"
    fi
}

# å»¶è¿ŸåŠ è½½ conda
if [[ -f "$HOME/miniforge3/etc/profile.d/conda.sh" ]]; then
    lazy_load conda "$HOME/miniforge3/etc/profile.d/conda.sh"
fi

# ============================================================================
# æœ€ç»ˆé…ç½®å’Œæ¸…ç†
# ============================================================================
# ç¡®ä¿è¡¥å…¨ç³»ç»Ÿæ­£ç¡®åˆå§‹åŒ–
autoload -Uz compinit
if [[ -n ${ZDOTDIR}/.zcompdump(#qN.mh+24) ]]; then
    compinit
else
    compinit -C
fi

# åŠ è½½è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
[[ -f ~/.zshrc.local ]] && source ~/.zshrc.local

# è®¾ç½®ç»ˆç«¯æ ‡é¢˜
case $TERM in
    xterm*|rxvt*|screen*|tmux*)
        precmd() {
            print -Pn "\e]0;%n@%m: %~\a"
        }
        ;;
esac

# æœ€åçš„ç¯å¢ƒæ£€æŸ¥
if ! command -v fzf &> /dev/null; then
    echo "âš ï¸  å»ºè®®å®‰è£… fzf ä»¥è·å¾—æ›´å¥½çš„æœç´¢ä½“éªŒ: brew install fzf"
fi

if ! command -v eza &> /dev/null && ! command -v exa &> /dev/null; then
    echo "âš ï¸  å»ºè®®å®‰è£… eza ä»¥è·å¾—æ›´å¥½çš„æ–‡ä»¶åˆ—è¡¨ä½“éªŒ: brew install eza"
fi
